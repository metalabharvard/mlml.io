{{ $membersScratch := newScratch }}
{{- $membersScratch.Set "members" slice -}}
{{- range $index, $element := (where .Site.RegularPages "Section" "members") -}}
  {{- $membersScratch.Add "members" (dict "type" "member" "name" $element.Params.Name "role" $element.Params.Role_string "slug" $element.Slug) -}}
{{- end -}}

{{ $eventsScratch := newScratch }}
{{- $eventsScratch.Set "events" slice -}}
{{- range $index, $element := (where .Site.RegularPages "Section" "events") -}}
  {{ $relatedMembers := newScratch }}
  {{- range $member := $element.Params.Members -}}
    {{- $relatedMembers.Add "members" (slice $member.name) -}}
  {{- end -}}
  {{- $eventsScratch.Add "events" (dict "type" "event" "title" $element.Title "intro" (plainify ($element.Params.Intro | markdownify)) "description" (replace (safeHTMLAttr (safeJS (plainify ($element.Params.Description | markdownify)))) "\n" " ") "members" ($relatedMembers.Get "members") "slug" $element.Slug) -}}
{{- end -}}

{{ $projectsScratch := newScratch }}
{{- $projectsScratch.Set "projects" slice -}}
{{- range $index, $element := (where .Site.RegularPages "Section" "projects") -}}
  {{ $relatedMembers := newScratch }}
  {{- range $member := $element.Params.Members -}}
    {{- $relatedMembers.Add "members" (slice $member.name) -}}
  {{- end -}}
  {{- $projectsScratch.Add "projects" (dict "type" "event" "title" $element.Title "intro" (plainify ($element.Params.Intro | markdownify)) "description" (replace (safeHTMLAttr (safeJS (plainify ($element.Params.Description | markdownify)))) "\n" " ") "members" ($relatedMembers.Get "members") "slug" $element.Slug) -}}
{{- end -}}

{{ $content := newScratch }}
{{ $content.SetInMap "list" "projects" ($projectsScratch.Get "projects") }}
{{ $content.SetInMap "list" "members" ($membersScratch.Get "members") }}
{{ $content.SetInMap "list" "events" ($eventsScratch.Get "events") }}
{{- $content.Get "list" | jsonify -}}